Index: nox-themes/default/template.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\n<html lang=\"{$locale}\" prefix=\"og: http://ogp.me/ns#\">\n<head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\n    <meta name=\"viewport\" content=\"width=960\">\n    <meta name=\"google-signin-clientid\" content=\"733576906216-eise0p2e10q0rc4omv3bs1ssfqe11t1n.apps.googleusercontent.com\" />\n\n    <title>{if $title}{$title} - {end}{$siteTitle}</title>\n\n    <meta property=\"og:locale\" content=\"{$locale}\" />\n    <meta property=\"og:title\" content=\"{if $title}{$title} - {end}{$siteTitle}\" />\n    <meta property=\"og:description\" content=\"{trim($description)}\" />\n    <meta property=\"og:url\" content=\"{noxSystem::$fullUrl}\" />\n    <meta property=\"og:image\" content=\"{$img_url}\" />\n\n    <link rel=\"shortcut icon\" href=\"{if isset($template_meta_icon)}{$templatye_meta_icon}{else}{$baseUrl}/favicon.ico?4{end}\">\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"{$commonFolder}/css/framework.css\">\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"/nox-themes/common/css/960.12.css\">\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"{$themeFolder}/css/common.css?{$version}\">\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"{$themeFolder}/css/style.css?{$version}\">\n    <!--[if IE]>\n    <script type=\"text/javascript\" src=\"https://html5shiv.googlecode.com/svn/trunk/html5.js\"></script>\n    <![endif]-->\n    <script src=\"{$themeFolder}/js/polyfill.min.js\"></script>\n    <script src=\"{$themeFolder}/js/vendor/angular.1.7.min.js\"></script>\n    <script src=\"//code.jquery.com/jquery-1.11.2.min.js\"></script>\n    <script src=\"https://apis.google.com/js/platform.js\" async defer></script>\n    <!-- Global site tag (gtag.js) - Google Ads: 1033691228 134724692-->\n    <script async src=\"https://www.googletagmanager.com/gtag/js?id=AW-1033691228\"></script>\n    <script src=\"//assets.pinterest.com/js/pinit.js\" async defer></script>\n    <script>\n        window.outlinesSession = {\n            user: <?=json_encode(noxSystem::getUser())?>\n        }\n    </script>\n    <script src=\"/nox-themes/default/js/main.js?{$version}\"></script>\n    {$head}\n    </head>\n    <body data-user-mode=\"{if noxSystem::authorization()}auth{else}guest{end}\">\n        <!-- Google Tag Manager (noscript) -->\n        <noscript><iframe src=\"https://www.googletagmanager.com/ns.html?id=GTM-TRR3XTH\" height=\"0\" width=\"0\" style=\"display:none;visibility:hidden\"></iframe></noscript>\n        <!-- End Google Tag Manager (noscript) -->\n        <!-- Facebook Pixel Code -->\n        <noscript><img height=\"1\" width=\"1\" style=\"display:none\" src=\"https://www.facebook.com/tr?id=434568580641569&ev=PageView&noscript=1\" alt=\"fb\"/></noscript>\n        <!-- End Facebook Pixel Code -->\n        <div data-ng-controller=\"NavController\">\n        <script>\n            window.fbAsyncInit = function() {\n                FB.init({\n                    appId: '<?=FACEBOOK_APP_ID?>',\n                    cookie: true,\n                    xfbml: true,\n                    version: '<?=FACEBOOK_APP_VER?>'\n                });\n            };\n\n            (function(d, s, id){\n                var js, fjs = d.getElementsByTagName(s)[0];\n                if (d.getElementById(id)) {\n                    return;}\n                js = d.createElement(s); js.id = id;\n                js.src = \"//connect.facebook.net/en_US/sdk.js\";\n                fjs.parentNode.insertBefore(js, fjs);\n            }(document, 'script', 'facebook-jssdk'));\n        </script>\n        <div id=\"fb-root\"></div>\n        <script async defer crossorigin=\"anonymous\" src=\"https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.3&appId=940234936010260&autoLogAppEvents=1\"></script>\n        <div>\n            <div id=\"log-panel\">\n                <div>\n                    <div class=\"tc text-right\">\n                        <a class=\"crumb\" href=\"/users/downloads\" data-ng-show=\"isAuthentificated\">My Downloads</a>\n                        <span data-ng-show=\"isAuthentificated\">&nbsp;|&nbsp;</span>\n                        <a class=\"crumb\" href=\"/users/downloads\" data-ng-show=\"isAuthentificated\" title=\"Check your prepay order status\">Order Status</a>\n                        <a data-ng-show=\"!isAuthentificated\" class=\"crumb js-popup\" data-wid=\"auth\" href=\"/users/login\" title=\"Login to get access to your downloads, purchases, request statuses and contact us\">Log in</a>\n                        <span>&nbsp;|&nbsp;</span>\n                        <a class=\"crumb\" href=\"/users/logout\" id=\"logout\" data-ng-show=\"isAuthentificated\">Log out</a>\n                        <a data-ng-show=\"!isAuthentificated\" class=\"crumb js-popup\" data-wid=\"reg_main\" href=\"#\" title=\"Create an account to get access to your downloads, purchases, request statuses and contact us\">Create account</a>\n                    </div>\n                </div>\n            </div>\n            <div id=\"header-stripe\">\n                <div class=\"container_12\">\n                    <div class=\"tc\">\n                        <a href=\"{$baseUrl}/\" id=\"header-logo\" title=\"Outlines - blueprints, templates and vector drawings producer since 2006.\">\n                            <img src=\"/nox-themes/default/images/outlines-logo.png\" width=\"130\" height=\"23\" alt=\"Outlines - blueprints and vector drawings online.\">\n                        </a>\n                        <form id=\"search\" method=\"get\" action=\"/search\" class=\"search_header cut\">\n                            <input class=\"input\" placeholder=\"(NEW) Search blueprints\" name=\"q\" list=\"sets\"\n                                   title=\"Type part of name to find blueprints and vector drawings. Enter 2 or more characters. Try to use general words, do not use too much or too specific words.\">\n                            <datalist id=\"sets\"></datalist>\n                            <input class=\"icon\" value=\"\" type=\"submit\">\n                        </form>\n                        <nav id=\"main-menu\" class=\"inline-block\">\n                            <ul>\n                                <li id=\"make-cars-btn\" title=\"Free blueprints \">\n                                    <a href=\"/car-blueprints\" title=\"Car blueprints\">Car Blueprints</a>\n                                </li>\n                                <li title=\"Vector Blueprints and Drawings. Editable vehicle templates.\">\n                                    <a href=\"/car-vector-drawings\" title=\"Car vector drawings, wrap blueprints and editable templates\">\n                                        <span>Car Vector Drawings</span>\n                                    </a>\n                                </li>\n                                <li>\n                                    <a href=\"{if isset($hookRequestLink)}{$hookRequestLink}{else}/requests{end}\"\n                                       title=\"Request blueprints and vector drawings online with 1 click. Pre-order and get it in a few work days. We offer high quality scalable editable blueprints.\">\n                                        <strong>Request Blueprint</strong></a>\n                                </li>\n                            </ul>\n                        </nav>\n                    </div>\n                    <div id=\"cartBtn\" {if !$cartTotal}data-empty{end} class=\"tc\">\n                        <a class=\"btn\" href=\"/checkout/cart\" title=\"Cart\">\n                            <img src=\"/nox-themes/default/images/cart-icon16.png\" width=\"16\" height=\"13\">\n                            <span id=\"cartTotal\" style=\"display: inline-block;\">Cart {$cartTotal}</span>\n                        </a>\n                    </div>\n                </div>\n            </div>\n            {if isset($makeTopCars)}\n            <div id=\"header-top-cars\">\n                <div class=\"container_12\">\n                    <div id=\"top-cars-cont\" class=\"top-top-cars-cont\">\n                        <div class=\"top-cars-cont container-row\">\n                            {eval $r = ceil(count($makeTopCars) / 6) - 1}\n                            {for $i=0 to 5}\n                            <div class=\"top-cars-col\">\n                                {for $j=0 to $r}\n                                {eval $ind = $i * ($r + 1) + $j}\n                                {if isset($makeTopCars[$ind])}\n                                {eval $m = $makeTopCars[$ind]}\n                                <a href=\"/car-blueprints/{$m[url]}\" title=\"{$m[name]} blueprints\">{$m[name]}</a>\n                                {end}\n                                {end}\n                            </div>\n                            {end}\n                        </div>\n                        <div class=\"top-cars-oper\">\n                            <a href=\"/car-blueprints\" class=\"btn hover\">View All Makes&nbsp;&nbsp;\n                                <img src=\"/nox-themes/default/images/goto-arrow.png\" width=\"18\" height=\"14\" alt=\"Go to\">\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            {end}\n        </div>\n        <script src=\"{$themeFolder}/js/vendor/vue.min.js\"></script>\n        <script src=\"{$themeFolder}/js/vc.min.js?{$version}\"></script>\n        <script src=\"{$themeFolder}/js/mix.min.js?{$version}\"></script>\n        {if isset($vueSpecial)}\n            {$content}\n        {else}\n            <div id=\"vue-scope\">\n                {$content}\n                <app-modal :is=\"vc.view.modal\"></app-modal>\n            </div>\n            <script src=\"{$themeFolder}/js/scope.min.js?{$version}\"></script>\n        {end}\n        <footer class=\"container_12\">\n            <div class=\"footer-row fb-wrap\">\n                <div>Want to upvote Outlines? Use this button. Together we will reach 10’000</div>\n                <div class=\"fb-like\" data-href=\"https://www.facebook.com/getoutlines\" data-width=\"448\" data-layout=\"button_count\" data-action=\"like\" data-size=\"large\" data-show-faces=\"false\" data-share=\"false\"></div>\n            </div>\n        </footer>\n        <footer class=\"container_12\">\n            <div class=\"footer-row container-row\">\n                <div class=\"footer-nav-column\">\n                    <div class=\"footer-nav-title\">Blueprints</div>\n                    <a href=\"/\" class=\"footer-nav-item\" title=\"Get Started\">Get Started</a>\n                    <a href=\"/car-blueprints\" class=\"footer-nav-item\" title=\"Car blueprints\">Car blueprints</a>\n                    <a href=\"/car-vector-drawings\" class=\"footer-nav-item\" title=\"Car vector drawings\">Car vector drawings</a>\n                    <a href=\"/requests\" class=\"footer-nav-item\" title=\"Request any blueprint\">Request any blueprint</a>\n                    <a href=\"/search\" class=\"footer-nav-item\" title=\"Search blueprints\">Search blueprints</a>\n                    <a href=\"/nox-data/vector/free/opel-corsa-c-3-door-2000.pdf\" target=\"_blank\"\n                       class=\"footer-nav-item\" title=\"PDF Example\">PDF Example</a>\n                    <a href=\"/blueprints\" class=\"footer-nav-item\" title=\"Other types of blueprints\">Other types of blueprints</a>\n                </div>\n                <div class=\"footer-nav-column\">\n                    <div class=\"footer-nav-title\">Use Cases</div>\n                    <a href=\"/cases/car-wrap-templates\" class=\"footer-nav-item\" title=\"Car Wrap Blueprints and Templates for Sign Write Design and Vehicle Lettering\">\n                        Car Wrap Templates</a>\n                </div>\n                <div class=\"footer-nav-column\">\n                    <div class=\"footer-nav-title\">Outlines</div>\n                    <a href=\"/about-us\" class=\"footer-nav-item\">About us</a>\n                    <a href=\"/about-us#feedback\" class=\"footer-nav-item\" rel=\"nofollow\">Contact us</a>\n                    <a href=\"/about-us#feedback\" class=\"footer-nav-item\" rel=\"nofollow\">Feedback</a>\n                    <a href=\"https://www.facebook.com/getoutlines/\" target=\"_blank\" class=\"footer-nav-item\">\n                        <div>Follow us on Facebook</div>\n                        <img src=\"/nox-themes/default/images/fb-logo-black24.png\" title=\"Join us on Facebook \"\n                             width=\"24\" height=\"24\">\n                    </a>\n                </div>\n                <div class=\"footer-nav-column\">\n                    <div class=\"footer-nav-title\">Help</div>\n                    {if noxSystem::authorization()}\n                    <!--noindex-->\n                    <a class=\"footer-nav-item\" href=\"mailto:hello@getoutlines.com?subject=Bulk Purchase of blueprints on Outlines&body=Hello, Outlines. I am interested in bulk purchase of vector blueprints. (Please do not remove these tags: bulk purchase, wholesale).\"\n                       target=\"_blank\">Bulk Purchase</a>\n                    <!--/noindex-->\n                    {else}\n                    <a class=\"footer-nav-item js-popup\" data-wid=\"reg_main\" data-wprm=\"bulk\"\n                       data-action=\"bulk\" href=\"#\">Bulk Purchase</a>\n                    {end}\n                    <a href=\"/refund-policy\" class=\"footer-nav-item\">Refund Policy</a>\n                    <a href=\"/terms-of-service\" class=\"footer-nav-item\">Terms of Use</a>\n                    <a href=\"/privacy-policy\" class=\"footer-nav-item\">Privacy Policy</a>\n                    <a href=\"/privacy-policy#cookie-policy\" class=\"footer-nav-item\">Cookie Policy</a>\n                </div>\n                <div class=\"footer-nav-column\">\n                    <div class=\"footer-nav-title\">Account</div>\n                    {if noxSystem::authorization()}\n                    <a class=\"footer-nav-item\" href=\"/users/downloads\">My Downloads</a>\n                    <a class=\"footer-nav-item\" href=\"/users/downloads\" title=\"Check your prepay order status\">Order Status</a>\n                    {else}\n                    <a class=\"footer-nav-item js-popup\" data-wid=\"reg_main\" href=\"#\">Create account</a>\n                    <a class=\"footer-nav-item js-popup\" data-wid=\"auth\" href=\"#\">Login</a>\n                    {end}\n                    <br>\n                    <div class=\"footer-nav-item oper\">\n                        <div id=\"country-btn\" class=\"country-item\">\n                            <img src=\"/nox-themes/default/images/eng-flag.png\" alt=\"eng\" width=\"16\" height=\"16\">\n                            <div>English</div>\n                            <img src=\"/nox-themes/default/images/menu-arrow.png\" alt=\"arrow\" width=\"7\" height=\"4\">\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"footer-row footer-info\">\n                <div class=\"footer-info-left\">\n                    <div>\n                        <a href=\"/\">\n                            <img src=\"/nox-themes/default/images/outlines-logo-black.png\" width=\"130\" height=\"23\" alt=\"Outline logo\">\n                        </a>\n                    </div>\n                    <br>\n                    <div>We make car blueprints, auto line vector drawings and diagram templates<br>\n                         for design. Request any car blueprint and get it in few days.</div>\n                    <br>\n                    <div>© 2006 - {date('Y')} Outlines.</div>\n                    <div>v.0.8.1 All rights reserved.</div>\n                </div>\n                <div class=\"footer-info-right\">\n                    <div>\n                        <img src=\"/nox-themes/default/images/lock-icon-black.png\" width=\"10\" height=\"12\" alt=\"Encrypted SSL\"> Secure Connection\n                    </div>\n                    <br>\n                    <div>\n                        <img src=\"/nox-themes/default/images/payment-logos.png\" width=\"191\" height=\"24\" alt=\"We accept Visa, MasterCard, American Express, PayPal and other\">\n                    </div>\n                </div>\n            </div>\n        </footer>\n        <auth></auth>\n        <div id=\"country-cont\">\n            <div class=\"country-item-wrap\">\n                <div class=\"country-item oper\">\n                    <img src=\"/nox-themes/default/images/eng-flag.png\" alt=\"eng\" width=\"16\" height=\"16\">\n                    <div>English</div>\n                    <img src=\"/nox-themes/default/images/menu-arrow.png\" alt=\"arrow\" width=\"7\" height=\"4\">\n                </div>\n            </div>\n            <div class=\"country-item-wrap\">\n                <a href=\"/regional/les-plans-de-voiture-dessins-modele\" title=\"Plans de voiture, dessins, modèles\" class=\"country-item\">\n                    <img src=\"/nox-themes/default/images/fra-flag.png\" alt=\"fra\" width=\"16\" height=\"16\">\n                    <div>Plans de voiture</div>\n                </a>\n            </div>\n        </div>\n        <div id=\"shadow\"></div>\n        <div class=\"window\" id=\"js-window__msg\">\n            <div class=\"frame\">\n                <div class=\"title\"></div>\n                <div class=\"content\">\n                    <div class=\"d-table w100p msg\"></div>\n                    <div class=\"text-center\" style=\"font-size: 14px;\">\n                        <div class=\"btn violet ok-close\">OK</div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"close\"></div>\n        </div>\n        {requireWindows()}\n        <script>\n            (function() {\n                let search = document.getElementById('search'),\n                    inp = search.q,\n                    def = inp.value,\n                    sets = document.getElementById('sets');\n                inp.addEventListener('keyup', function () {\n                    if((inp.value !== def) && (inp.value.length > 1)){\n                        def = inp.value;\n                        $.ajax({\n                            url: '/hint',\n                            data: {\n                                'q': def\n                            },\n                            method: 'get',\n                            success: function (data) {\n                                let el;\n                                sets.innerHTML = '';\n                                data = JSON.parse(data);\n                                for(let i = 0; i < data.length; i++){\n                                    el = document.createElement('option');\n                                    el.setAttribute('value', data[i]);\n                                    sets.appendChild(el);\n                                }\n                            }\n                        });\n                    }\n                });\n                inp.addEventListener('change', function () {\n                    (inp.value !== '') && search.submit();\n                });\n            })();\n        </script>\n        <popup2></popup2>\n        <script type=\"application/ld+json\">\n                [{\n                    \"@context\": \"http://schema.org\",\n                    \"@type\": \"Organization\",\n                    \"name\": \"Outlines Car Blueprints\",\n                    \"description\": \"Free reference of blueprints of cars. We make fine quality vector line drawings and vehicle templates for sale. Learn more on getoutlines.com\",\n                    \"url\": \"https://{noxSystem::$domain}\",\n                    \"logo\": \"https://{noxSystem::$domain}/nox-themes/default/images/outlines-logo.png\",\n                    \"sameAs\" : [ \"https://www.facebook.com/getoutlines/\"]\n                },\n                    {\n                        \"@context\": \"http://schema.org\",\n                        \"@type\": \"WebSite\",\n                        \"url\": \"https://{noxSystem::$domain}\",\n                        \"potentialAction\": {\n                            \"@type\": \"SearchAction\",\n                            \"target\": \"https://{noxSystem::$domain}/search?q={$fakeSearchTerm}\",\n                            \"query-input\": \"required name=search_term\"\n                        }\n                    }]\n            </script>\n        </div>\n        <div id=\"fakeJsPopup\" class=\"js-popup\"></div>\n    </body>\n</html>\n
===================================================================
diff --git a/nox-themes/default/template.html b/nox-themes/default/template.html
--- a/nox-themes/default/template.html	
+++ b/nox-themes/default/template.html	
@@ -1,5 +1,6 @@
 <!DOCTYPE html>
 <html lang="{$locale}" prefix="og: http://ogp.me/ns#">
+
 <head>
     <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
     <meta name="viewport" content="width=960">
@@ -25,15 +26,19 @@
     <script src="{$themeFolder}/js/vendor/angular.1.7.min.js"></script>
     <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
     <script src="https://apis.google.com/js/platform.js" async defer></script>
+
     <!-- Global site tag (gtag.js) - Google Ads: 1033691228 134724692-->
     <script async src="https://www.googletagmanager.com/gtag/js?id=AW-1033691228"></script>
+
     <script src="//assets.pinterest.com/js/pinit.js" async defer></script>
     <script>
         window.outlinesSession = {
             user: <?=json_encode(noxSystem::getUser())?>
         }
     </script>
+
     <script src="/nox-themes/default/js/main.js?{$version}"></script>
+
     {$head}
     </head>
     <body data-user-mode="{if noxSystem::authorization()}auth{else}guest{end}">
Index: .idea/moga.iml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<module type=\"WEB_MODULE\" version=\"4\">\n  <component name=\"NewModuleRootManager\">\n    <content url=\"file://$MODULE_DIR$\">\n      <sourceFolder url=\"file://$MODULE_DIR$/spec\" isTestSource=\"true\" />\n      <sourceFolder url=\"file://$MODULE_DIR$/tests\" isTestSource=\"true\" />\n    </content>\n    <orderEntry type=\"inheritedJdk\" />\n    <orderEntry type=\"sourceFolder\" forTests=\"false\" />\n  </component>\n</module>
===================================================================
diff --git a/.idea/moga.iml b/.idea/moga.iml
--- a/.idea/moga.iml	
+++ b/.idea/moga.iml	
@@ -4,6 +4,9 @@
     <content url="file://$MODULE_DIR$">
       <sourceFolder url="file://$MODULE_DIR$/spec" isTestSource="true" />
       <sourceFolder url="file://$MODULE_DIR$/tests" isTestSource="true" />
+      <excludeFolder url="file://$MODULE_DIR$/vendor/facebook/graph-sdk" />
+      <excludeFolder url="file://$MODULE_DIR$/vendor/facebook/php-ads-sdk" />
+      <excludeFolder url="file://$MODULE_DIR$/vendor/composer" />
     </content>
     <orderEntry type="inheritedJdk" />
     <orderEntry type="sourceFolder" forTests="false" />
Index: .idea/php.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"MessDetectorOptionsConfiguration\">\n    <option name=\"transferred\" value=\"true\" />\n  </component>\n  <component name=\"PHPCSFixerOptionsConfiguration\">\n    <option name=\"transferred\" value=\"true\" />\n  </component>\n  <component name=\"PHPCodeSnifferOptionsConfiguration\">\n    <option name=\"transferred\" value=\"true\" />\n  </component>\n  <component name=\"PhpProjectSharedConfiguration\" php_language_level=\"7.0\">\n    <option name=\"suggestChangeDefaultLanguageLevel\" value=\"false\" />\n  </component>\n  <component name=\"PhpStanOptionsConfiguration\">\n    <option name=\"transferred\" value=\"true\" />\n  </component>\n  <component name=\"PsalmOptionsConfiguration\">\n    <option name=\"transferred\" value=\"true\" />\n  </component>\n</project>
===================================================================
diff --git a/.idea/php.xml b/.idea/php.xml
--- a/.idea/php.xml	
+++ b/.idea/php.xml	
@@ -9,11 +9,23 @@
   <component name="PHPCodeSnifferOptionsConfiguration">
     <option name="transferred" value="true" />
   </component>
+  <component name="PhpIncludePathManager">
+    <include_path>
+      <path value="$PROJECT_DIR$/vendor/facebook/graph-sdk" />
+      <path value="$PROJECT_DIR$/vendor/facebook/php-ads-sdk" />
+      <path value="$PROJECT_DIR$/vendor/composer" />
+    </include_path>
+  </component>
   <component name="PhpProjectSharedConfiguration" php_language_level="7.0">
     <option name="suggestChangeDefaultLanguageLevel" value="false" />
   </component>
   <component name="PhpStanOptionsConfiguration">
     <option name="transferred" value="true" />
+  </component>
+  <component name="PhpUnit">
+    <phpunit_settings>
+      <PhpUnitSettings custom_loader_path="$PROJECT_DIR$/vendor/autoload.php" />
+    </phpunit_settings>
   </component>
   <component name="PsalmOptionsConfiguration">
     <option name="transferred" value="true" />
Index: nox-themes/default/js/main.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>/// <reference path=\"../../../typings/tsd.d.ts\" />\nvar outlines;\n(function (outlines) {\n    outlines.MODULE = 'outlines';\n    angular.module(outlines.MODULE, []);\n    angular.element(document).ready(function () {\n        angular.bootstrap(document, [outlines.MODULE]);\n    });\n})(outlines || (outlines = {}));\nfunction base64_decode(data) {\n    var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, enc = '';\n    do {\n        h1 = b64.indexOf(data.charAt(i++));\n        h2 = b64.indexOf(data.charAt(i++));\n        h3 = b64.indexOf(data.charAt(i++));\n        h4 = b64.indexOf(data.charAt(i++));\n        bits = h1 << 18 | h2 << 12 | h3 << 6 | h4;\n        o1 = bits >> 16 & 0xff;\n        o2 = bits >> 8 & 0xff;\n        o3 = bits & 0xff;\n        if (h3 == 64)\n            enc += String.fromCharCode(o1);\n        else if (h4 == 64)\n            enc += String.fromCharCode(o1, o2);\n        else\n            enc += String.fromCharCode(o1, o2, o3);\n    } while (i < data.length);\n    return enc;\n}\n\nvar outlines;\n(function (outlines) {\n    var VectorPrintController = (function () {\n        function VectorPrintController(popupService) {\n            this.popupService = popupService;\n        }\n        VectorPrintController.prototype.openPaymentDialog = function (vectorId, daysMax) {\n            this.popupService.open(PopupViews.VECTOR_PAYMENT, { vectorId: vectorId, daysMax: daysMax });\n        };\n        VectorPrintController.$inject = ['popupService'];\n        return VectorPrintController;\n    }());\n    angular.module('outlines').controller('vectorPrintController', VectorPrintController);\n    /*\n    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n     */\n    var PaymentController = (function () {\n        function PaymentController(popupService) {\n            this.popupService = popupService;\n            this.processing = false;\n            this.paymentType = null;\n        }\n        Object.defineProperty(PaymentController.prototype, \"vectorId\", {\n            get: function () {\n                return this.popupService.scope.vectorId;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(PaymentController.prototype, \"daysMax\", {\n            get: function () {\n                return this.popupService.scope.daysMax;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        PaymentController.prototype.pay = function (paymentType) {\n            this.paymentType = paymentType;\n            this.processing = true;\n        };\n        PaymentController.$inject = ['popupService'];\n        return PaymentController;\n    }());\n    angular.module('outlines').controller('paymentController', PaymentController);\n})(outlines || (outlines = {}));\n\nvar outlines;\n(function (outlines) {\n    var PopupService = (function () {\n        function PopupService($timeout) {\n            this.$timeout = $timeout;\n            this.isOpen = false;\n            this.scope = null;\n            this.template = null;\n            document.addEventListener('keyup', function (e) {\n                if (this.isOpen) {\n                    return true;\n                }\n                switch (e.keyCode) {\n                    case 27:\n                        $timeout(this.close.bind(this));\n                        return false;\n                    default:\n                        return true;\n                }\n            });\n        }\n        PopupService.prototype.open = function (template, scope) {\n            if (typeof template === 'string')\n                this.template = template;\n            this.isOpen = true;\n            this.scope = (scope) ? scope : null;\n        };\n        PopupService.prototype.close = function () {\n            this.isOpen = false;\n        };\n        PopupService.$inject = ['$timeout'];\n        return PopupService;\n    }());\n    outlines.PopupService = PopupService;\n    angular.module('outlines').service('popupService', PopupService);\n})(outlines || (outlines = {}));\nvar PopupViews = {\n    VECTOR_PAYMENT: '/nox-themes/default/templates/app/payment-type.html'\n};\n\nvar outlines;\n(function (outlines) {\n    var VectorPayController = (function () {\n        function VectorPayController($attrs, $sce, popupService) {\n            this.popupService = popupService;\n            this.price = $sce.trustAsHtml($attrs['price']);\n            this.paytype = $sce.trustAsHtml($attrs['paytype']);\n        }\n        VectorPayController.prototype.openDialog = function () {\n            this.popupService.open(PopupViews.VECTOR_PAYMENT, { vectorId: this.vectorId, daysMax: this.daysMax });\n        };\n        VectorPayController.$inject = ['$attrs', '$sce', 'popupService'];\n        return VectorPayController;\n    }());\n    outlines.VectorPayController = VectorPayController;\n})(outlines || (outlines = {}));\n\nvar outlines;\n(function (outlines) {\n    var vectorPayDirective = {\n        restrict: 'E',\n        templateUrl: '/nox-themes/default/templates/app/vector-pay.html',\n        controller: outlines.VectorPayController,\n        controllerAs: 'vectorPayCtrl',\n        scope: {\n            vectorId: '=',\n            daysMax: '=',\n            large: '=?',\n            invertColors: '=?'\n        },\n        bindToController: true\n    };\n    angular.module(outlines.MODULE).directive('vectorPay', function () { return vectorPayDirective; });\n})(outlines || (outlines = {}));\n\nvar outlines;\n(function (outlines) {\n    var VectorPreviewController = (function () {\n        function VectorPreviewController() {\n        }\n        return VectorPreviewController;\n    }());\n    outlines.VectorPreviewController = VectorPreviewController;\n    var Vector = (function () {\n        function Vector() {\n            this.id = null;\n            this.name = null;\n            this.full_name = null;\n        }\n        return Vector;\n    }());\n    outlines.Vector = Vector;\n})(outlines || (outlines = {}));\n\nvar outlines;\n(function (outlines) {\n    var vectorPreviewDirective = {\n        restrict: 'E',\n        templateUrl: '/nox-themes/default/templates/app/vector-preview.html',\n        controller: outlines.VectorPreviewController,\n        controllerAs: 'vectorPreviewCtrl',\n        link: function (scope, element, attrs, ctrl) {\n            ctrl.vector = JSON.parse(base64_decode(attrs['vector']));\n        }\n    };\n    angular.module(outlines.MODULE).directive('vectorPreview', function () { return vectorPreviewDirective; });\n})(outlines || (outlines = {}));\n\n(function () {\n    function NavController($scope, userService) {\n        this.$inject = ['$scope', 'userService'];\n\n        $scope.isAuthentificated = userService.isAuthentificated();\n    }\n\n    angular.module('outlines').controller('NavController', NavController);\n})();\n(function() {\n    angular.module('outlines').factory('dataService', [dataService]);\n\n    function dataService() {\n        var session = window.outlinesSession;\n        var locationQuery;\n\n        return {\n            getFromSession: function(key) {\n                return session[key];\n            },\n            getFromLocationQuery: function(key) {\n                \n            }\n        }\n    }\n})();\nfunction upData(method, url, data, callback, onerror, prm) {\n    var r = new XMLHttpRequest();\n    r.open(method, url);\n    method === 'POST' && r.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    r.onreadystatechange = function() {\n        if(r.readyState === 4)\n            if(r.status === 200){\n                callback && callback(r.responseText, prm);\n            }else{\n                onerror && onerror(prm);\n            }\n    };\n    r.send(data);\n}\n\ndocument.addEventListener('DOMContentLoaded', function () {\n    //php console\n    let cons = document.getElementById('console'),\n        headerStripe = document.getElementById('header-stripe'),\n        headerTopCars = document.getElementById('header-top-cars'),\n        topCarsCont = document.getElementById('top-cars-cont'),\n        makeCarsBtn = document.getElementById('make-cars-btn'),\n        makeCarsHide = false;\n    if(cons) {\n        let re = /FILE:/g,\n            errors = document.body.textContent.match(re),\n            d = document.createElement('div');\n        d.innerHTML = 'Errors: ' + (errors ? errors.length : 0);\n        cons.insertBefore(d, cons.firstElementChild);\n        cons.addEventListener('click', function () {\n            cons.className = cons.className ? '' : 'full';\n        });\n    }\n    //top panel position\n    function onScrollMain() {\n        let topPanelHeight = 28,\n            scroll = topPanelHeight - window.scrollY;\n        headerStripe.style.top = (scroll > 0 ? scroll : 0) + 'px';\n        headerTopCars.style.top = (scroll > 0 ? (scroll + 48) : 48) + 'px';\n    }\n    window.addEventListener('scroll', onScrollMain);\n    onScrollMain();\n\n    let pageScrollTo = document.getElementById('pageScrollTo'),\n        _pageScrollTo = document.getElementById('_pageScrollTo');\n    function _scrollTo() {\n        pageScrollTo && pageScrollTo.scrollIntoView();\n    }\n    /page=\\d/.test(location.search) && _scrollTo();\n    _pageScrollTo && _pageScrollTo.addEventListener('click', _scrollTo);\n\n    if(makeCarsBtn){\n        makeCarsBtn.addEventListener('mouseenter', function () {\n            if(makeCarsHide){\n                clearTimeout(makeCarsHide);\n                makeCarsHide = false;\n            }\n            document.body.setAttribute('cars-top', 'show');\n        });\n        makeCarsBtn.addEventListener('mouseleave', function () {\n            makeCarsHide = setTimeout(hideTopCars, 100);\n        });\n        topCarsCont && topCarsCont.addEventListener('mouseleave', function () {\n            if(!makeCarsHide){\n                makeCarsHide = setTimeout(hideTopCars, 100)\n            }\n        })\n    }\n    function hideTopCars(){\n        document.body.removeAttribute('cars-top');\n        makeCarsHide = false;\n    }\n\n    //Scroll left block\n    let scCont = document.querySelector('.content .js_column-scroll'),\n        mCont = document.getElementById('mc');\n    if(scCont && mCont){\n        let rCont = document.getElementById('rc'), db = false,\n            rH = rCont ? rCont.getBoundingClientRect().height : 0,\n            mH = mCont.getBoundingClientRect().height, h, wCont;\n        if(rH > mH){\n            h = rH; wCont = rCont;\n        } else {\n            h = mH; wCont = mCont;\n        }\n        db && console.log(wCont);\n        if(scCont.getBoundingClientRect().height < h){\n            let sc = document.getElementById('sc'),\n                wH = document.documentElement.clientHeight,\n                xyCont = scCont.getBoundingClientRect(),\n                offTop = +sc.getAttribute('data-os') || (xyCont.top - 50),\n                touchY = 0,\n                scrOn = false,\n                deltaY = 0;\n            console.log(offTop, sc.getBoundingClientRect());\n            function onScrollLeft() {\n                let scrollY = window.pageYOffset || document.documentElement.scrollTop;\n                if(scrollY > offTop && !scrOn) {\n                    scrOn = true;\n                    scCont.classList.add('column-fixed');\n                    scCont.style.width = xyCont.width + 'px';\n                }\n                else if(scrollY < offTop && scrOn) {\n                    scrOn = false;\n                    scCont.classList.remove('column-fixed');\n                    scCont.removeAttribute('style');\n                    sc.removeAttribute('style');\n                }\n                if(scrOn){\n                    let xySc = sc.getBoundingClientRect(),\n                        xyData = wCont.getBoundingClientRect(),\n                        fix = scrollY + xyData.top;\n                    if(xyData.bottom <= wH) {\n                        sc.style.top = Math.min(xyData.bottom - xySc.height, 74) + 'px';\n                        db && console.log('1');\n                    } else if(xySc.height + 74 < wH){\n                        sc.style.top = '74px';\n                        db && console.log('1.5');\n                    } else if((deltaY > 0) && (xySc.bottom > wH)){\n                        sc.style.top = (xySc.y - deltaY) + 'px';\n                        db && console.log('2');\n                    } else if((deltaY < 0) && (xySc.top > xyData.top)){\n                        sc.style.top = Math.min(xySc.y - deltaY, 74) + 'px';\n                        db && console.log('3');\n                    } else {\n                        db && console.log('4');\n                    }\n                    db && console.log(offTop, scrollY, 't', xySc.top, xyData.top, 'b', xySc.bottom, xyData.bottom, deltaY, wH, h, fix);\n                }\n                deltaY = 0;\n            }\n            document.addEventListener('scroll', onScrollLeft);\n            sc.addEventListener('wheel', function (e) {\n                deltaY = e.deltaY || 0;\n            });\n            sc.addEventListener('touchstart', touchHandler);\n            sc.addEventListener('touchend', touchHandler);\n            sc.addEventListener('touchcancel', touchHandler);\n            function touchHandler(e) {\n                switch (e.type) {\n                    case 'touchstart':\n                        touchY = e.touches[0].screenY;\n                        break;\n                    case 'touchcancel':\n                    case 'touchend':\n                        if(touchY){\n                            deltaY = touchY - e.changedTouches[0].screenY;\n                        }\n                        touchY = 0;\n                        break;\n                }\n            }\n            onScrollLeft();\n        }\n    }\n\n    // countries\n    let cBtn = document.getElementById('country-btn'),\n        cCont = document.getElementById('country-cont');\n    cBtn.addEventListener('click', function (e) {\n        e.stopImmediatePropagation();\n        let xy = cBtn.getBoundingClientRect(),\n            scrolled = window.pageYOffset || document.documentElement.scrollTop;\n        cCont.style.top = (scrolled + xy.y - 5) + 'px';\n        cCont.style.left = (xy.x - 15) + 'px';\n        cCont.style.display = 'block';\n        console.log(xy, scrolled);\n    });\n    document.addEventListener('click', function () {\n        cCont.style.display = 'none';\n    });\n});\n(function() {\n    \"use strict\";\n\n    angular.module('outlines').directive('loader', function() {\n        return {\n            restrict: 'E',\n            templateUrl: '/nox-themes/default/templates/app/loader.html',\n            controller: function() {},\n            controllerAs: 'loaderCtrl',\n            bindToController: true,\n            scope: {\n                style: '='\n            }\n        }\n    })\n})();\n(function() {\n    \"use strict\";\n\n    var PopupController = function(popupService) {\n        this.popupService = popupService;\n\n        Object.defineProperty(this, 'template', {\n            get: function() {\n                return this.popupService.template;\n            }\n        });\n    };\n\n    PopupController.prototype.isOpen = function() {\n        return this.popupService.isOpen;\n    };\n\n    PopupController.$inject = ['popupService'];\n\n    angular.module('outlines').directive('popup2', function() {\n        return {\n            restrict: 'E',\n            templateUrl: '/nox-themes/default/templates/app/popup.html',\n            controller: PopupController,\n            controllerAs: 'popupCtrl'\n        }\n    });\n\n    var PopupCloseController = function(popupService) {\n        this.popupService = popupService;\n    };\n\n    PopupController.$inject = ['popupService'];\n\n    PopupCloseController.prototype.close = function() {\n        this.popupService.close();\n    };\n\n    angular.module('outlines').directive('popupClose', function() {\n        return {\n            restrict: 'E',\n            replace: true,\n            template: '<div class=\"popup-close\" ng-click=\"popupCloseCtrl.close()\"></div>',\n            controller: PopupCloseController,\n            controllerAs: 'popupCloseCtrl'\n        }\n    });\n})();\n\n(function() {\n    angular.module('outlines').factory('userService', ['dataService', userService]);\n\n    function userService(dataService) {\n        var user = dataService.getFromSession('user');\n\n        return {\n            getUser: function() {\n                return user;\n            },\n            isAuthentificated: function() {\n                return !!user;\n            },\n            authentificate: function() {\n\n            }\n        }\n    }\n})();\nwindow.appGlobals = {\n    afterLoginUrl: window.location.toString()\n};\n\n// GoogleAnalytics\n(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n})(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n// Google Tag Manager\n(function(w,d,s,l,i) { w[l]=w[l]||[];w[l].push( { 'gtm.start':new Date().getTime(),event:'gtm.js' } );var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); } )(window,document,'script','dataLayer','GTM-TRR3XTH');\nwindow.dataLayer = window.dataLayer || [];\nfunction gtag(){dataLayer.push(arguments);}\ngtag('js', new Date());\ngtag('config', 'AW-1033691228');\n// Facebook Pixel Code\n!function(f,b,e,v,n,t,s)\n{if(f.fbq)return;n=f.fbq=function(){n.callMethod?\n    n.callMethod.apply(n,arguments):n.queue.push(arguments)};\n    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';\n    n.queue=[];t=b.createElement(e);t.async=!0;\n    t.src=v;s=b.getElementsByTagName(e)[0];\n    s.parentNode.insertBefore(t,s)}(window, document,'script',\n    'https://connect.facebook.net/en_US/fbevents.js');\nfbq('init', '434568580641569');\nfbq('track', 'PageView');\n\nwindow.outlinesSession.user\n? ga('create', 'UA-59815736-1', 'auto', {\n    userId: window.outlinesSession.user.id\n})\n: ga('create', 'UA-59815736-1', 'auto');\nga('send', 'pageview');\n\njQuery.fn.Windows = function( ) {\n    var self = this;\n    self.shadow = $('#shadow');\n    self.activeWindow = false;\n    self.templates = {\n        buy: {\n            msg: 'Sign up to buy blueprints. All purchased items will be available in your Downloads page. Or ' +\n            '<a href=\"#\" class=\"js-popup\" data-wid=\"auth\">login now</a>'\n        },\n        confirm_email: {\n            title: 'Confirm your email',\n            msg: 'Confirmation email sent. Check your email and confirm your email address. <br/><br/>' +\n                'If you have not received our email in a few minutes, please check your spam folder. ' +\n                'Otherwise <a href=\"mailto:hello@getoutlines.com?subject=Please activate my account' +\n                '&body=Hello, Outlines. I have not received your confirmation email. Please activate ' +\n                'my account manually. Regards.\" target=\"_blank\">contact us</a> ' +\n                'from the same email for manual activation.',\n            ok: 'I received Confirm Email'\n        },\n        confirm_email_fb: {\n            title: 'Your email is confirmed',\n            msg: 'Your email is confirmed now you could receive personal notifications.'\n        },\n        email_re_sent: {\n            title: 'This email is not confirmed.',\n            msg: 'This email is not confirmed. We have re-sent a confirmation email to you right now. ' +\n                'Please check your email and confirm your email.',\n        },\n        email_sent: {\n            title: 'This email is not confirmed.',\n            msg: 'This email is not confirmed. We have sent a confirmation email to you after your registration. ' +\n                'Please check your email and confirm your email.',\n        },\n        on_cant: {\n            title: 'Can not be produced',\n            msg: 'We have estimated this request before and unfortunately marked it as impossible to ' +\n                'produce.<br><br>Please ensure that the vehicle you need exists and it is possible to find ' +\n                'appropriate sources to produce its blueprint. Try to change year, model or version name ' +\n                'and request again.'\n        },\n        on_want_free: {\n            title: 'Request submitted',\n            msg: 'We got your Free request, now please wait, due to many free requests it could be processed ' +\n                'in a long time.<br><br>Otherwise, if you want to purchase it in premium vector quality and ' +\n                'get in a few work days, please use “Want to buy vector” button.'\n        },\n        on_want_pay: {\n            title: 'Now wait for Quotation',\n            msg: 'We got your request. We are going to estimate the price and if it\\'s feasible to make ' +\n                'this blueprint. Please wait for Quotation and Pre-payment Link to your email in a few work ' +\n                'days in case if your request is feasible.'\n        },\n        prepayment_success: {\n            title: 'Prepayment Success',\n            msg: 'Your order is in development now.<br/><br/>You will receive ready vector blueprints ' +\n                'on your email and got in <a href=\"/users/downloads\">My Downloads</a> page.'\n        },\n        registration_success: {\n            title: 'Successful Registration',\n            msg: 'Your account has ben activated. Let’s read our <a href=\"/\" target=\"_blank\">Get started</a> ' +\n                'tips.<br/><br/>Now you can purchase vector blueprints and request any blueprint. All your purchased ' +\n                'blueprints collect on My Downloads page.'\n        },\n        registration_success_fb: {\n            title: 'Successful Registration',\n            msg: 'Please confirm your email now to receive personal notifications.<br><br>' +\n                'Your account has ben activated. Let’s read our <a href=\"/\" target=\"_blank\">Get started</a> ' +\n                'tips.<br/><br/>Now you can purchase vector blueprints and request any blueprint. All your purchased ' +\n                'blueprints collect on My Downloads page.'\n        },\n        reset_email: {\n            title: 'Check your email',\n            msg: 'We have sent you an email to reset your password. Please check your email.'\n        },\n        reset_pass: {\n            title: 'Password changed',\n            msg: 'You have successfully changed your password.'\n        },\n        blueprint_force: {\n            msg: 'Sign up per 1 click to post your request and get personal notification when it will be done. Or ' +\n            '<a class=\"js-popup\" data-wid=\"auth\" href=\"#\">Login</a>'\n        },\n        blueprint_download: {\n            msg: 'To continue downloading free blueprints you have to create an account.'\n        },\n        bulk: {\n            msg: 'Sign up and click again to contact us with Bulk Purchase Order. Or ' +\n                '<a class=\"js-popup\" data-wid=\"auth\" href=\"#\">Login</a> now.'\n        },\n        request: {\n            msg: 'Your request has been added. Please sign up or login to keep in touch with Outlines and know ' +\n            'when we upload this blueprint. Thanks.'\n        },\n        estimate: {\n            msg: 'Please sign up or login to get a quotation.'\n        },\n        unsubscribe: {\n            msg: 'You have been unsubscribed from these emails.',\n            title: 'You are now unsubscribed'\n        },\n        use_login: {\n            title: 'Use login',\n            msg: 'Use login.'\n        },\n        vote: {\n            msg: 'Please sign up or login to add your vote.'\n        }\n    };\n\n    self.open = function(w, prm, url) {\n        var tmp;\n        self.shadow.addClass('visible');\n        if(self.activeWindow) {\n            url = self.closeActiveWindow(true);\n        }\n\n        self.activeWindow = $('#js-window__' + w);\n        console.log(w, prm);\n        if(prm && (tmp = self.templates[prm])){\n            tmp.title && self.activeWindow.find('.title').html(tmp.title);\n            self.activeWindow.find('.msg').html(tmp.msg);\n            tmp.ok && self.activeWindow.find('.ok-close').html(tmp.ok);\n        }\n        if(url){\n            self.activeWindow.attr('wnd-onClose-last', 'forceLocation');\n            self.activeWindow.attr('forceLocation', url);\n        }\n        self.activeWindow.addClass('visible');\n        self.activeWindow.height(self.activeWindow.find('.frame').height());\n    };\n\n    self.closeActiveWindow = function(doNotHideShadow) {\n        var url = (self.activeWindow.attr('wnd-onClose-last') === 'forceLocation') && self.activeWindow.attr('forceLocation');\n        onClose('wnd-onClose');\n        if(!doNotHideShadow){\n            self.shadow.removeClass('visible');\n            onClose('wnd-onClose-last');\n        }\n        self.activeWindow.removeClass('visible');\n        onClose('wnd-onClose-after');\n        self.activeWindow.find('.msg').html('');\n        self.activeWindow.attr('wnd-onClose-last', '');\n        self.activeWindow.attr('forceLocation', '');\n        self.activeWindow = false;\n        return url;\n        function onClose(step) {\n            var onCloseFuncName = self.activeWindow.attr(step);\n            if(onCloseFuncName && (typeof window[onCloseFuncName] === 'function')) {\n                window[onCloseFuncName](self.activeWindow);\n            }\n        }\n    };\n\n    $('.js-popup').on('click', function() {\n        var w = this.getAttribute('data-wid') || this.getAttribute('wid'),\n            prm = this.getAttribute('data-wprm'),\n            action = this.getAttribute('data-action');\n        console.log(w);\n        if(action){\n            cookie.set('myLastAction', action, {\n                path: '/',\n                expires: 1e6\n            });\n        }\n        self.open(w, prm);\n        return false;\n    });\n\n    $('.window .close, .window .ok-close').on('click', function() {\n        self.closeActiveWindow();\n        return false;\n    });\n    self.shadow.on('click', function() {\n        self.closeActiveWindow();\n        return false;\n    });\n\n    return self;\n};\n\nfunction forceLocation(obj) {\n    var to = obj.attr('forceLocation');\n    to && location.assign(to);\n}\n\nfunction glSign(authResult, reg) {\n    if (authResult['status'] && authResult['status']['signed_in']) {\n        gapi.client.load('plus', 'v1').then(function() {\n            var request = gapi.client.plus.people.get({\n                'userId': 'me'\n            });\n            request.then(function(resp) {\n                $.ajax({\n                    url: '/users/login',\n                    data: {\n                        'auth': authResult,\n                        'user': resp,\n                        'user_type': 'google'\n                    },\n                    method: 'post',\n                    success: function(data) {\n                        if(reg){\n                            windows.open('msg', 'registration_success', data.url);\n                        }else{\n                            window.location = data.url || window.appGlobals.afterLoginUrl.split('#')[0];\n                        }\n                    },\n                    error: function() {\n                        alert('Some error. Try again later.');\n                    }\n                });\n            }, function(reason) {\n                alert('Error:' + reason.result.error.message);\n            });\n        });\n    } else if (authResult['error']) {\n\n    }\n}\nfunction glSigninCallbackReg(authResult) {\n    glSign(authResult, true);\n}\n\nfunction glSigninCallback(authResult) {\n    glSign(authResult)\n}\n\nfunction social() {\n    // [FB]\n    function FB_login(email) {\n        FB.login(function () {\n            FB.getLoginStatus(function(response) {\n                // console.log('FB', response);\n                if (response.status === 'connected') {\n                    // FB.api('/me', {fields: ['name', 'email']}, function(r) {\n                    //     console.log('Successful login for: ', r);\n                    // });\n                    response.user_type = 'facebook';\n                    response.email = email;\n                    $.ajax({\n                        url: '/users/login',\n                        data: response,\n                        method: 'post',\n                        success: function(data) {\n                            if(email){\n                                windows.open('msg', 'registration_success_fb', data.url);\n                            }else{\n                                window.location = data.url || window.appGlobals.afterLoginUrl.split('#')[0];\n                            }\n                        },\n                        error: function() {\n                            alert('Some error. Try again later.');\n                        }\n                    });\n                }  else {\n\n                }\n            });\n        }/*, {scope: 'email'}*/);\n    }\n    $('.js-fb_login').on('click', function() {\n        window.appGlobals.afterLoginUrl = (this.getAttribute('data-continueurl')) ? this.getAttribute('data-continueurl') : window.location.toString();\n        FB_login();\n    });\n    let $form = $('#js-window__reg_fb').find('form');\n    $form.ajaxForm(\n        function() {\n            FB_login($form.find('[name=\"registration[email]\"]').val());\n        },\n        function(a) {\n            let x = JSON.parse(a.responseText);\n            console.log(a.responseText);\n            alert(x.error);\n        }\n    );\n// [/FB]\n// [GL]\n    $('.js-gl_login').on('click', function() {\n        window.appGlobals.afterLoginUrl = (this.getAttribute('data-continueurl')) ? this.getAttribute('data-continueurl') : window.location.toString();\n        gapi.auth.signIn({\n            'cookiepolicy' : 'single_host_origin',\n            'callback' : 'glSigninCallback',\n            'scope' : 'https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email',\n            'requestvisibleactions': 'http://schema.org/AddAction'\n        });\n        //window.windows.closeActiveWindow();\n    });\n    $('.js-gl_reg').on('click', function() {\n        gapi.auth.signIn({\n            'cookiepolicy' : 'single_host_origin',\n            'callback' : 'glSigninCallbackReg',\n            'scope' : 'https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email',\n            'requestvisibleactions': 'http://schema.org/AddAction'\n        });\n    });\n// [/GL]\n}\n\njQuery.fn.ajaxForm = function(onSuccess, onError) {\n    var self = $(this);\n    self.on('submit', function(e) {\n        e.preventDefault();\n        var data = self.serializeArray();\n\n        $.ajax({\n            async: false,\n            method: self.attr('method') || 'get',\n            url: self.attr('action'),\n            data: data,\n            success: onSuccess,\n            error: onError\n        });\n        return false;\n    });\n};\n\n\n$(document).ready(function(){\n    social();\n    window.windows = jQuery.fn.Windows();\n\n    $('.captcha').click(function () {\n        var i = $(this);\n        var src = i.data('src') || i.attr('src');\n        i.data('src', src);\n        i.attr('src', src + '?' + Math.random());\n    });\n\n    (function() {\n        var po = document.createElement('script'); po.type = 'text/javascript';\n        po.src = 'https://apis.google.com/js/client:platform.js';\n        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);\n    })();\n\n    //Позволяет делать в форме одно требуемое поле из нескольких\n    $('form').has('.js-input-requires').each(function() {\n        var $requires = $(this).find('.js-input-requires');\n        $requires.attr('required', 'required');\n        $requires.on('input', function() {\n            if(this.value) {\n                $requires.removeAttr('required');\n            }\n            else {\n                for(var i in $requires) {\n                    if($requires.eq(i).val()) {\n                        $requires.removeAttr('required');\n                        return;\n                    }\n                }\n                $requires.attr('required', 'required');\n            }\n        });\n    });\n    (function() {\n        //Делаем лоадер на кнопках покупки\n        $('.js-fb_login, .js-gl_login').addClass('js-loader');\n        var $jsProgress = $('.js-loader');\n        var busy = false;\n        var tmp_ls = {\n            orange: '/nox-themes/default/images/loader-orange.gif',\n            purple: '/nox-themes/default/images/loader-purple.gif'\n        };\n        if($jsProgress.length) {\n            for(var i in tmp_ls) {\n                if(tmp_ls.hasOwnProperty(i)) {\n                    var l = new Image();\n                    l.src = tmp_ls[i];\n                }\n            }\n        }\n        $jsProgress.on('click', function() {\n            if(busy) return false;\n            if(this.target === '_blank') return true;\n            busy = true;\n            var that = $(this);\n            if(that.hasClass('.jss-loader-action')) {\n                busy = false;\n                return false;\n            }\n            else {\n                this.setAttribute('data-olddata', this.innerHTML);\n                if(that.hasClass('violet')) {\n                    this.innerHTML = '<img src=\"/nox-themes/default/images/loader-purple.gif\">&nbsp;Please&nbsp;wait';\n                }\n                else {\n                    this.innerHTML = '<img src=\"/nox-themes/default/images/loader-orange.gif\">&nbsp;Please&nbsp;wait';\n                }\n                that.parents('.vector-block-preview').addClass('hover');\n\n                $jsProgress.filter('.jss-loader-action').each(function() {\n                    this.innerHTML = this.getAttribute('data-olddata');\n                    $(this).removeClass('jss-loader-action').parents('.vector-block-preview').removeClass('hover');\n                });\n                this.classList.add('jss-loader-action');\n\n                busy = false;\n            }\n        });\n    })();\n\n    $('.js-lh').each(function() {\n        var that = $(this);\n        that.css('line-height', that.height() + 'px');\n    });\n});\n\nwindow.cookie = {\n    set: function(name, value, options) {\n        options = options || {};\n        var expires = options.expires;\n        if (typeof expires == \"number\" && expires) {\n            var d = new Date();\n            d.setTime(d.getTime() + expires*1000);\n            expires = options.expires = d;\n        }\n        if (expires && expires.toUTCString) options.expires = expires.toUTCString();\n        var updatedCookie = name + \"=\" + encodeURIComponent(value);\n        for(var propName in options) {\n            updatedCookie += \"; \" + propName;\n            var propValue = options[propName];\n            if (propValue !== true) {\n                updatedCookie += \"=\" + propValue;\n            }\n        }\n        document.cookie = updatedCookie;\n    },\n    get: function(name) {\n        var matches = document.cookie.match(new RegExp(\n            \"(?:^|; )\" + name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + \"=([^;]*)\"\n        ));\n        return matches ? decodeURIComponent(matches[1]) : undefined;\n    },\n    'delete': function(name) {\n        this.set(name, \"\", {expires: -1})\n    }\n};\n\nvar AuthEvents = {\n    // Listen\n    AuthMe: 'AuthMe'\n};\n\n(function() {\n    angular.module('outlines').directive('auth', [authDirective]);\n\n    function AuthCtrl(userService, $scope) {\n        $scope.showDialog = false;\n\n        this.show = function() {\n            $scope.showDialog = true;\n        };\n        this.hide = function() {\n            $scope.showDialog = false;\n        };\n\n        $scope.$on(AuthEvents.AuthMe, function() {\n\n        });\n    }\n\n    function authDirective() {\n        return {\n            restrict: 'E',\n            controllerAs: 'authCtrl',\n            templateUrl: '/nox-themes/default/templates/app/auth.html',\n            controller: ['userService', '$scope', AuthCtrl]\n        }\n    }\n})();\n\n\n\n
===================================================================
diff --git a/nox-themes/default/js/main.js b/nox-themes/default/js/main.js
--- a/nox-themes/default/js/main.js	
+++ b/nox-themes/default/js/main.js	
@@ -208,6 +208,22 @@
             }
         }
     }
+})();
+(function() {
+    "use strict";
+
+    angular.module('outlines').directive('loader', function() {
+        return {
+            restrict: 'E',
+            templateUrl: '/nox-themes/default/templates/app/loader.html',
+            controller: function() {},
+            controllerAs: 'loaderCtrl',
+            bindToController: true,
+            scope: {
+                style: '='
+            }
+        }
+    })
 })();
 function upData(method, url, data, callback, onerror, prm) {
     var r = new XMLHttpRequest();
@@ -383,22 +399,6 @@
 });
 (function() {
     "use strict";
-
-    angular.module('outlines').directive('loader', function() {
-        return {
-            restrict: 'E',
-            templateUrl: '/nox-themes/default/templates/app/loader.html',
-            controller: function() {},
-            controllerAs: 'loaderCtrl',
-            bindToController: true,
-            scope: {
-                style: '='
-            }
-        }
-    })
-})();
-(function() {
-    "use strict";
 
     var PopupController = function(popupService) {
         this.popupService = popupService;
